;-----------------------------------------------------------------------------
; Protected Mode 진입
;-----------------------------------------------------------------------------
entry_PM:
    cli                     ; 인터럽트 비활성화
    lgdt [gdt_descriptor]   ; GDT 로드
    call enable_a20         ; A20 활성화
    mov eax, cr0
    or al, 1
    mov cr0, eax            ; CR0 레지스터의 PE bit를 1로 설정

    jmp CODE_SEG:PROTECTEDMODE

;-----------------------------------------------------------------------------
; A20 활성화
;-----------------------------------------------------------------------------
enable_a20:
    in al, 0x92
    or al, 0x02        ; bit1 = A20
    and al, 0xFE       ; bit0 = reset disable
    out 0x92, al
    ret

;--------------------------------------------------------------------------------
; 외부 코드 포함
;--------------------------------------------------------------------------------
%include "boot/gdt.asm"